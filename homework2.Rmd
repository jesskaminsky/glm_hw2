---
title: "PHP 2514 - Homework 2"
author: "Jess Kaminsky"
date: "3/05/2018"
output: html_document
---

```{r setup, include=FALSE}
library(stargazer)
library(knitr)
```

```{r, echo = FALSE}
wine <- read.csv("Wine.csv")
names(wine)[1] <- "COUNTRY"

wine$log.wine <- log(wine$WINE)
wine$log.mortality <- log(wine$MORTALITY)
```

1A.
When exploring the relationship between CHD mortality rate from wine consumption level, the plot of of the raw data - mortality rate vs. wine consumption - appears nonlinear. To further explore the trend between our outcome and predictor, we will consider log transformations on the outcome, the predictor, or both. Based on the scatterplots below, plot 4, the plot that shows log wine consumption vs log mortality appears the most linear.
```{r}
par(mfrow = c(2,2))
plot(wine$WINE, wine$MORTALITY, ylab = "CHD Mortality Rate", xlab = "Wine Consumption")
plot(wine$WINE, wine$log.mortality, ylab = "Log CHD Mortality Rate", xlab = "Wine Consumption")
plot(wine$log.wine, wine$MORTALITY, ylab = "CHD Mortality Rate", xlab = "Log Wine Consumption")
plot(wine$log.wine, wine$log.mortality, ylab = "Log CHD Mortality Rate", xlab = "Log Wine Consumption")
```

To further assess which transformation will generate the best predictive model, we will generate a linear model for the raw data and each of the transformations to be considered.

```{r star, results = 'asis', warning=FALSE, message=FALSE, echo = FALSE}
m1 <- lm(wine$MORTALITY ~ wine$WINE)
m2 <- lm(wine$log.mortality ~ wine$WINE)
m3 <- lm(wine$MORTALITY ~ wine$log.wine)
m4 <- lm(wine$log.mortality ~ wine$log.wine)
summary(m1)
summary(m2)
summary(m3)
summary(m4)

par(mfrow = c(2,2))
plot(m1)
plot(m2)
plot(m3)
plot(m4)

stargazer(m1, type = "html")
stargazer(m2, type = "html")
stargazer(m3, type = "html")
stargazer(m4, type = "html")
```
When assessing the four linear models that have been fit, model 4 appears to be the best model for predicting CHD mortality from wine consumption. Model 4 has the highest r-squared value - 72.21% of the variation in CHD mortality rate can be explained by wine consumption. Also, when comparing the normal Q-Q plots among all 4 models, we see that the points on the Q-Q plot for model 4 fall closest to the line overall - therefore satisfying the normality assumption of a linear model. The points on the plot of residuals vs fitted for model 4 appears to be the most randomly and evenly distributed around 0 when compared to the other 3 models. The residual standard error for this model is 0.2885, the smallest among all 4 models.

When fitting a linear model on the raw data, predicting mortality rate from wine consumption, the results indicate:

CHD Mortality Rate = 7.68655 - 0.07608*Wine Consumption

This model suggets that the mortality rate for a country with wine consumption equal to 0 is 7.68655. For every 10 unit increase in wine consumption, we expect CHD mortality rate to decrease by .7608.

Model 2 fits a linear model predicting the log mortality rate from wine consumption.

Log CHD Mortality Rate = 2.045 - 0.0159*Wine Consumption

When wine consumption is equal to 0 the expected log mortality rate is 2.045. To transform this expectation back from the log scale, we should compute e^2.045 = 7.729. That is - if a country does not consume wine, its CHD Mortality Rate is expected to be 7.729. For every 10 unit increase in wine consumption, ##we expect a median proportional decrease of e^(0.0159*10) = 1.172 in CHD Mortality Rate##

Model 3 fits a linear model predicting CHD mortality rate from log wine consumption.

CHD Mortality Rate = 10.2795 - 1.771*Log Wine Consumption

When wine consumption is equal to 1 - log wine consumption is equal to 0 - we expect CHD mortality rate to be 10.2795. Doubling the wine consumption rate decreases the CHD mortality rate by log(2)*1.771 = 1.227.

Model 4 fits a linear model predicting log CHD mortality rate from log wine consumption. 

Log CHD Mortality Rate = 2.55 - 0.3556*Log Wine Consumption

When wine consumption is equal to 1 - log wine consumption is equal to 0 - we expect mortality rate to be e^2.55 = 12.81. If wine consumption doubles then CHD mortality decreases by 21.84% - CHD mortality is 78.15% of its original value determined by calculating e^(-0.355*log(2)) = 0.7815.

*QUESTION 2*

```{r, echo = FALSE}
bush <- read.csv("Bush.csv")
names(bush)[1] <- "country"

for(i in 2:ncol(bush)){
  bush[,i] <- as.numeric(bush[,i])
}

remove_pb <- bush[!bush$country %in% c("PALM BEACH"),]
pb_data <- bush[bush$country %in% c("PALM BEACH"),]

```

2A.

```{r}
plot(remove_pb$bush2000, remove_pb$buchanan2000, xlab = "Number of Votes for Bush", ylab = "Number of Votes for Buchanan", main = "Votes for George W. Bush and Pat Buchanan in 2000 Election")

attach(remove_pb)
buch_lm <- lm(buchanan2000~bush2000)


predict(buch_lm, data.frame(bush2000 = pb_data$bush2000), interval = "prediction")
```


2B.
```{r}


```


QUESTION 3
```{r, echo = FALSE}
bloodbrain <- read.csv("BloodBrain.csv")
names(bloodbrain)[1] <- "BRAIN"
```


Compute "Jittered" versions of-treatment, days after inoculation, and an indicator variable for females by adding small random numbers to each (uniform random numbers between -.15 and .15 work well). Or you could use the jitter function.

```{r}
bloodbrain$FACTOR.TIME <- as.factor(bloodbrain$TIME)

bloodbrain$JITTER.DAYS <- jitter(bloodbrain$DAYS)

bloodbrain$TREAT <- as.numeric(bloodbrain$TREAT)
bloodbrain$JITTER.TREAT <- jitter(bloodbrain$TREAT)

bloodbrain$SEX <- as.numeric(bloodbrain$SEX)
for(i in 1:length(bloodbrain$SEX)) {
  if(bloodbrain$SEX[i] == 2) {
    bloodbrain$SEX[i] <- 0
  }
}
bloodbrain$JITTER.SEX <- jitter(bloodbrain$SEX)
```

Obtain a matrix of scatter plots for the following variables: log sacrifice time, treatment (jittered), days after inoculation (jittered), sex (jittered), and the log of the brain tumor-to-liver antibody ratio. Use the function pairs in the graphics package or scatterplotMatrix in the car package.

```{r}
pairs(~log(TIME) + JITTER.TREAT + JITTER.DAYS + JITTER.SEX + log(BRAIN/TUMOR), data = bloodbrain)
```

Obtain a matrix of the correlation coefficients among the same five variables (not jittered).

```{r}
pairs(~log(TIME) + TREAT + DAYS + SEX + log(BRAIN/TUMOR), data = bloodbrain)
```

On the basis of this, what can be said about the relationship between the covariates (sex and days after inoculation), the response, and the design variables (treatment and sacrifice time.

Fit the regression of the log response (brain tumor-to-liver antibody ratio) on an indicator variable for treatment and on sacrifice time treated as a factor with four levels (include three indicator variables, for sacrifice time == 3, 24, and 72 hours). Use the model to find the estimated mean of the log response at each of the eight treatment combinations (all combinations of the two infusions and the four sacrifice times).


```{r}
bloodbrain$TREAT <- as.factor(bloodbrain$TREAT)

m5 <- lm(log(BRAIN/TUMOR) ~ TREAT + FACTOR.TIME, data = bloodbrain)

inputs <- data.frame(TREAT = as.factor(c(rep(1,4), rep(2,4))), FACTOR.TIME = as.factor(c(rep(c(.5,3,24,72),2))))

ESTIMATES <- predict(m5, inputs)

results <- cbind(inputs, ESTIMATES)
kable(results)
```

Let X represent log of sacrifice time. Fit the regression of the log response on an indicator variable for treatment, X, X2, and X3. Use the estimated model to find the estimated mean of the log response at each of the eight treatment combinations.

```{r}
bloodbrain$LOG.TIME <- log(bloodbrain$TIME)

m6 <- lm(log(BRAIN/TUMOR) ~ TREAT + LOG.TIME, data = bloodbrain)

log.inputs <- data.frame(cbind(TREAT = inputs$TREAT, LOG.TIME = rep(unique(bloodbrain$LOG.TIME), 2))) 

log.inputs$TREAT <- as.factor(log.inputs$TREAT)

LOG.ESTIMATES <- predict(m6, log.inputs)

log.results <- cbind(log.inputs, LOG.ESTIMATES)
kable(log.results)
```

Why are the answers to parts (5) and (6) the same?

Fit the regression of the log response (brain tumor-to-liver antibody ratio) on all covariates, the treatment indicator, and sacrifice time, treated as a factor with four levels (include three indicator variables, for sacrifice time == 3, 24, and s72 hours).

```{r}
m7 <- lm(log(BRAIN/TUMOR) ~ DAYS + SEX + WEIGHT + LOSS + TUMOR + TREAT + FACTOR.TIME, data = bloodbrain)
```

Obtain a set of case influence statistics, including a measure of influence, the leverage, and the studentized residual.

```{r}
influence.measures(m7)
```

Discuss whether any influential observations or outliers occur with respect to this fit.


QUESTION 5

```{r}
#y in an rXm matrix of Y values
#x is a vector of X values

lmq <- function(y,x) {
  
  
}

```


